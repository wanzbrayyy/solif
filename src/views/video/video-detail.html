<template>
  <require from="../../components/movie-card"></require>

  <div class="container">
    
    <div if.bind="isLoading" class="loading-container">
      <i class="fas fa-circle-notch fa-spin fa-3x"></i>
    </div>

    <div if.bind="!isLoading && movie">
      
      <div class.bind="movie.type === 'Series' ? 'video-layout-series' : 'video-layout-movie'">
        <!-- Kolom Kiri: Player & Info -->
        <div class="player-column">
          <div class="video-player-wrapper">
            <video if.bind="currentVideoUrl" controls autoplay class="video-player">
              <source src.bind="currentVideoUrl" type="video/mp4">
              Browser Anda tidak mendukung tag video.
            </video>
            <div if.bind="!currentVideoUrl" class="no-source-overlay">
              <i class="fas fa-video-slash"></i>
              <span>Source video tidak tersedia</span>
            </div>
          </div>

          <div class="video-info-section">
            <h1 class="video-title">${movie.title}</h1>
            
            <div class="video-meta-bar">
              <span><i class="fas fa-eye"></i> ${movie.views}</span>
              <span class="dot">â€¢</span>
              <span><i class="fas fa-clock"></i> ${movie.duration}</span>
            </div>
            <p class="description">${movie.description}</p>

            <!-- RESOLUTION PICKER -->
            <div class="resolution-picker" if.bind="movie.sources.length > 0">
              <button repeat.for="source of movie.sources" 
                      class="btn-res ${currentVideoUrl === source.videoUrl ? 'active' : ''}" 
                      click.delegate="changeResolution(source.videoUrl)">
                <i class="fas fa-play-circle"></i> ${source.quality}p
              </button>
            </div>
          </div>
        </div>

        <!-- Kolom Kanan: Daftar Episode (Hanya untuk Series) -->
        <div class="episodes-column" if.bind="movie.type === 'Series'">
          <div class="episode-list-container">
            <div repeat.for="group of movie.episodeGroups" class="season-group">
              <h3>Season ${group.season}</h3>
              <div class="episode-grid">
                <button repeat.for="ep of group.episodeList" 
                        class="btn-episode ${movie.activeSeason == group.season && movie.activeEpisode == ep.episode ? 'active' : ''}"
                        click.delegate="changeEpisode(group.season, ep.episode)">
                  Eps ${ep.episode}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RELATED MOVIES -->
      <div class="related-section" if.bind="relatedMovies.length > 0">
        <h3 class="section-title"><i class="fas fa-film"></i> Tontonan Serupa</h3>
        <div class="grid">
          <movie-card repeat.for="rel of relatedMovies" movie.bind="rel"></movie-card>
        </div>
      </div>

    </div>
  </div>
</template>